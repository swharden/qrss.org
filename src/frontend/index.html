<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .thumbnail {
            width: 300px;
            padding: 0.5rem;
        }
    </style>
</head>

<body>
    <div class="container" id="container"></div>
    <script>
        fetch('/api/v1')
            .then(response => response.json())
            .then(data => {

                const container = document.getElementById("container");

                const div = document.createElement("div");
                div.innerHTML = `<code>${new Date().toTimeString()}</code>`;
                div.classList.add("my-5")
                container.appendChild(div);

                Object.entries(data).forEach(([key, value]) => {

                    value.reverse();
                    const latestGrab = value[0];
                    const latestAgeMinutes = Math.round(latestGrab.ageSeconds / 60);

                    const div = document.createElement("h2");
                    div.innerText = `${key} (${latestAgeMinutes} minutes)`;
                    div.classList.add("mt-5")
                    container.appendChild(div);

                    value.forEach(grab => {
                        const div = document.createElement("div");
                        const ageMinutes = Math.round(grab.ageSeconds / 60);
                        div.innerText = `${grab.filename} (${ageMinutes} minutes)`;
                        container.appendChild(div);
                    });

                    value.forEach(grab => {
                        console.log(grab.grabberID);
                        const grabDiv = document.createElement("div");
                        grabDiv.classList.add('d-inline-block');
                        const url = `/data/grabs/${grab.filename}`;
                        grabDiv.innerHTML = `
                            <a href='${url}' target='_blank'>
                            <img src='${url}' class='thumbnail'>
                            </a>
                        `
                        container.appendChild(grabDiv);
                    });

                });
            });
    </script>

</body>

</html>